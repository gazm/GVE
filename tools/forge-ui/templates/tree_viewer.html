<div class="tree-viewer" role="tree" aria-label="Scene hierarchy">
    <div class="tree-root" role="treeitem" aria-expanded="true" data-tree-root>
        <span class="tree-toggle" aria-hidden="true" title="Collapse">‚ñº</span>
        <span class="tree-label">{{ root_name }}</span>
    </div>
    <ul class="tree-children" id="tree-children" role="group">
        {% for slot in slots %}
        {% if not slot.empty %}
        <li class="tree-item" role="treeitem" data-card-id="{{ slot.asset_id }}" data-asset-id="{{ slot.asset_id }}" data-slot-type="{{ slot.slot_type }}"
            hx-get="/api/assets/partials/editor/{{ slot.asset_id }}" hx-target="#property-editor" hx-trigger="click" hx-swap="innerHTML"
            onclick="selectCard('{{ slot.asset_id }}')">
            <span class="tree-icon tree-icon-{{ slot.slot_type }}">{{ slot.slot_type[0]|upper }}</span>
            <span class="tree-label">{{ slot.name }}</span>
            <span class="tree-meta">({{ slot.slot_type }})</span>
            <span class="tree-actions">
                <button class="tree-action-btn tree-hide-btn" onclick="event.stopPropagation(); toggleHideAsset('{{ slot.asset_id }}')" title="Hide/Show">
                    <span class="action-icon">üëÅ</span>
                </button>
                <button class="tree-action-btn tree-delete-btn" onclick="event.stopPropagation(); deleteAssetFromChain('{{ slot.asset_id }}', '{{ slot.slot_type }}')" title="Remove from chain">
                    <span class="action-icon">üóë</span>
                </button>
            </span>
        </li>
        {% endif %}
        {% endfor %}
    </ul>
</div>
<script>
(function() {
    // Tree collapse/expand
    var root = document.querySelector('#tree-viewer [data-tree-root]');
    if (root) {
        root.addEventListener('click', function(e) {
            if (e.target.classList.contains('tree-toggle')) {
                var group = this.parentElement.querySelector('.tree-children');
                var expanded = this.getAttribute('aria-expanded') !== 'false';
                if (group) group.style.display = expanded ? 'none' : '';
                this.setAttribute('aria-expanded', expanded ? 'false' : 'true');
                this.textContent = expanded ? '‚ñ∂' : '‚ñº';
                this.setAttribute('title', expanded ? 'Expand' : 'Collapse');
            }
        });
    }
    
    // Restore hidden state after tree refresh
    if (window._hiddenAssets) {
        document.querySelectorAll('.tree-item').forEach(function(item) {
            var assetId = item.getAttribute('data-asset-id');
            if (assetId && window._hiddenAssets.has(assetId)) {
                item.classList.add('hidden');
            }
        });
    }
})();
</script>
